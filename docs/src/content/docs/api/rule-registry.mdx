---
title: Rule Registry
description: API reference for the RuleRegistry class
---

The `RuleRegistry` class manages registration and storage of validation rules, both global and instance-specific.

:::note[Internal Class]
This is an internal class used by the `Validator`. Most users will interact with it through the Validator's public API.
:::

```php
use Frostybee\Valicomb\Core\RuleRegistry;
```

## Constants

### ERROR_DEFAULT

```php
public const ERROR_DEFAULT = 'Invalid';
```

The default error message used when no custom message is provided.

---

## Static Methods

### addGlobalRule()

Register a global validation rule available to all Validator instances.

```php
public static function addGlobalRule(
    string $name,
    callable $callback,
    ?string $message = null
): void
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `$name` | string | The rule name |
| `$callback` | callable | The validation function |
| `$message` | string\|null | Optional custom error message |

```php
RuleRegistry::addGlobalRule('myRule', function($field, $value, $params) {
    return $value === 'expected';
}, 'Value must be expected');
```

:::tip
Prefer using `Validator::addRule()` which delegates to this method.
:::

### getGlobalRules()

Get all globally registered rules.

```php
public static function getGlobalRules(): array
```

**Returns:** Associative array of rule names to callbacks.

---

## Instance Methods

### __construct()

Create a new RuleRegistry instance.

```php
public function __construct(object $validator)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `$validator` | object | The validator instance this registry is attached to |

### addInstanceRule()

Add a rule specific to this validator instance.

```php
public function addInstanceRule(
    string $name,
    callable $callback,
    ?string $message = null
): void
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `$name` | string | The rule name |
| `$callback` | callable | The validation function |
| `$message` | string\|null | Optional custom error message |

```php
$registry->addInstanceRule('customCheck', function($field, $value) {
    return $value === 'custom';
}, 'Must be custom');
```

### getAllRules()

Get all rules (instance + global, with instance taking precedence).

```php
public function getAllRules(): array
```

**Returns:** Merged array of instance and global rules.

### getAllRuleMessages()

Get all rule messages (instance + global).

```php
public function getAllRuleMessages(): array
```

**Returns:** Merged array of instance and global rule messages.

### hasValidator()

Check if a validator exists (as a rule or method).

```php
public function hasValidator(string $name): bool
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `$name` | string | The rule name to check |

**Returns:** `true` if the validator exists, `false` otherwise.

### getUniqueRuleName()

Generate a unique rule name for closure-based rules.

```php
public function getUniqueRuleName(string|array $fields): string
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `$fields` | string\|array | Field name(s) to base the name on |

**Returns:** A unique rule name (e.g., `email_rule` or `email_rule_12345`).

### getInstanceRules()

Get instance-specific rules.

```php
public function getInstanceRules(): array
```

### getInstanceRuleMessages()

Get instance-specific rule messages.

```php
public function getInstanceRuleMessages(): array
```

### clearInstanceRules()

Clear all instance-specific rules.

```php
public function clearInstanceRules(): void
```

### cloneForValidator()

Create a clone for a new validator instance.

```php
public function cloneForValidator(object $validator): self
```

**Returns:** A new RuleRegistry with copied instance rules.

---

## Callback Signature

Rule callbacks must follow this signature:

```php
function(string $field, mixed $value, array $params, array $fields): bool
```

| Parameter | Description |
|-----------|-------------|
| `$field` | Field name being validated |
| `$value` | Current value of the field |
| `$params` | Additional parameters passed to the rule |
| `$fields` | All field data (for cross-field validation) |

**Must return:** `true` if valid, `false` if invalid.
